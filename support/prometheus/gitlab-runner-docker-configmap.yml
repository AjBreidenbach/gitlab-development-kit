apiVersion: v1
kind: ConfigMap
metadata:
  name: gitlab-runner-scripts
data:
  entrypoint: |
    #!/bin/bash

    set -xe

    cp /scripts/config.toml /etc/gitlab-runner/

    # Register the runner
    /entrypoint register --non-interactive \
      --url http://192.168.0.32:3000/ci \
      --registration-token "fixedtoken" \
      --executor kubernetes \
      --kubernetes-privileged=true

    # Start the runner
    /entrypoint run --user=gitlab-runner \
      --working-directory=/home/gitlab-runner
  config.toml: |
    concurrent = 1
    check_interval = 10
