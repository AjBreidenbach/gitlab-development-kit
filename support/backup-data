#!/usr/bin/env sh

set -e
echo "INFO:" >&2
echo "INFO: We're about to remove PostgreSQL data, Rails uploads and" >&2
echo "INFO: git repository data." >&2
echo "INFO: Are you sure?" >&2
echo "INFO:" >&2
echo "INFO: Press [ENTER] to continue." >&2
read -r

timestamp=$(date +%Y-%m-%d_%H.%M.%S)

echo "INFO: Moving PostgreSQL data into postgresql/data.${timestamp}.." >&2
mv postgresql/data postgresql/data.${timestamp}

echo "INFO: Moving uploads data into gitlab/public/uploads.${timestamp}.." >&2
mv gitlab/public/uploads gitlab/public/uploads.${timestamp}

echo "INFO: Moving repository data into repositories.${timestamp}.." >&2
mv repositories repositories.${timestamp}
mkdir repositories
mv repositories.${timestamp}/.gitkeep repositories/
